<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Bayt Essential - Mon Planner Spirituel & Quotidien</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f8f0e8 0%, #e8d5d5 100%);
            min-height: 100vh;
            color: #5d4037;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
        }

        /* STYLES POUR AUTHENTIFICATION */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border: 3px solid #d4af37;
            max-width: 500px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: 0;
        }

        .auth-card > * {
            position: relative;
            z-index: 1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .auth-header {
            margin-bottom: 30px;
        }

        .islamic-pattern {
            font-size: 24px;
            color: #d4af37;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .main-title {
            font-size: 2.5em;
            color: #b85450;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            font-weight: bold;
        }

        .subtitle {
            font-size: 1.1em;
            color: #8d6e63;
            font-style: italic;
            margin-bottom: 15px;
        }

        .bismillah {
            font-size: 1.2em;
            color: #b85450;
            margin: 20px 0;
            padding: 15px;
            background: rgba(184, 84, 80, 0.1);
            border-radius: 10px;
            border-left: 4px solid #b85450;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #5d4037;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #b85450;
            box-shadow: 0 0 15px rgba(184, 84, 80, 0.2);
            transform: translateY(-2px);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
            background: linear-gradient(135deg, #b8941f 0%, #d4af37 100%);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .link-button {
            background: none;
            border: none;
            color: #b85450;
            text-decoration: underline;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
        }

        .link-button:hover {
            color: #8d6e63;
        }

        .error-message {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #e74c3c;
        }

        .success-message {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #27ae60;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #d4af37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* STYLES POUR LE PLANNER (réutilisés du code précédent) */
        .planner-container {
            display: none;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid #d4af37;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: 0;
        }

        .header > * {
            position: relative;
            z-index: 1;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid #d4af37;
        }

        .user-name {
            color: #5d4037;
            font-weight: bold;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .amana-notice {
            background: rgba(184, 84, 80, 0.1);
            border: 2px solid #b85450;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .amana-notice h3 {
            color: #b85450;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-align: center;
            font-size: 14px;
        }

        .nav-tab:hover, .nav-tab.active {
            background: #d4af37;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styles responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .auth-card {
                padding: 30px 20px;
                margin: 20px;
            }
            
            .main-title {
                font-size: 2em;
            }
            
            .user-info {
                position: static;
                justify-content: center;
                margin-bottom: 20px;
            }
        }

        /* Styles additionnels pour le planner */
        .welcome-section {
            text-align: center;
        }

        .personal-info {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .instructions {
            background: rgba(142, 36, 170, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #8e24aa;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .instructions li::before {
            content: "🌿";
            position: absolute;
            left: 0;
        }

        .month-theme-container {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8bbd9 0%, #e6a7d0 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .month-theme-container::before {
            content: '🦋';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 3em;
            opacity: 0.3;
        }

        .month-theme-container::after {
            content: '🌸';
            position: absolute;
            bottom: 10px;
            left: 20px;
            font-size: 2em;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- ÉCRAN D'INSCRIPTION -->
    <div id="register-screen" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="islamic-pattern">☪ ❋ ☪ ❋ ☪ ❋ ☪</div>
                <h1 class="main-title">El Bayt Essential</h1>
                <p class="subtitle">"Mon planner spirituel & quotidien"</p>
                <div class="islamic-pattern">☪ ❋ ☪ ❋ ☪ ❋ ☪</div>
            </div>

            <div class="bismillah">
                🌸 Bismillah – Bienvenue ma sœur en Allah 🌸<br>
                Assalamu 'alayki wa rahmatullahi wa barakatuh
            </div>

            <form id="register-form">
                <div id="register-messages"></div>
                
                <div class="form-group">
                    <label for="register-name">Ton prénom *</label>
                    <input type="text" id="register-name" name="name" required placeholder="Ton prénom...">
                </div>

                <div class="form-group">
                    <label for="register-email">Email *</label>
                    <input type="email" id="register-email" name="email" required placeholder="ton.email@exemple.com">
                </div>

                <div class="form-group">
                    <label for="register-password">Mot de passe *</label>
                    <input type="password" id="register-password" name="password" required placeholder="Ton mot de passe sécurisé...">
                </div>

                <div class="form-group">
                    <label for="register-confirm">Confirmer le mot de passe *</label>
                    <input type="password" id="register-confirm" name="confirm" required placeholder="Confirme ton mot de passe...">
                </div>

                <div class="form-group">
                    <label for="register-dua">Ta dua personnelle</label>
                    <textarea id="register-dua" name="dua" placeholder="Ton invocation préférée (optionnel)..." rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="register-aspiration">La musulmane que tu veux devenir</label>
                    <textarea id="register-aspiration" name="aspiration" placeholder="Tes aspirations spirituelles (optionnel)..." rows="3"></textarea>
                </div>

                <div class="loading" id="register-loading">
                    <div class="spinner"></div>
                    <p>Création de ton compte...</p>
                </div>

                <button type="submit" class="btn" id="register-btn">Créer mon compte 🌟</button>
                
                <button type="button" class="link-button" onclick="showLogin()">
                    J'ai déjà un compte - Me connecter
                </button>
            </form>

            <div style="margin-top: 30px; padding: 15px; background: rgba(142, 36, 170, 0.1); border-radius: 10px; font-size: 14px;">
                <p><strong>🌿 CE PLANNER EST UNE AMĀNA</strong></p>
                <p>En créant ton compte, tu t'engages à respecter ce contenu personnel et à l'utiliser avec sincérité pour ton cheminement spirituel.</p>
            </div>
        </div>
    </div>

    <!-- ÉCRAN DE CONNEXION -->
    <div id="login-screen" class="auth-container" style="display: none;">
        <div class="auth-card">
            <div class="auth-header">
                <div class="islamic-pattern">☪ ❋ ☪ ❋ ☪ ❋ ☪</div>
                <h1 class="main-title">Connexion</h1>
                <p class="subtitle">Retrouve ton espace spirituel</p>
                <div class="islamic-pattern">☪ ❋ ☪ ❋ ☪ ❋ ☪</div>
            </div>

            <div class="bismillah">
                🌸 Bismillah – Bon retour ma sœur 🌸<br>
                Qu'Allah bénisse ta journée
            </div>

            <form id="login-form">
                <div id="login-messages"></div>
                
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" name="email" required placeholder="ton.email@exemple.com">
                </div>

                <div class="form-group">
                    <label for="login-password">Mot de passe</label>
                    <input type="password" id="login-password" name="password" required placeholder="Ton mot de passe...">
                </div>

                <div class="loading" id="login-loading">
                    <div class="spinner"></div>
                    <p>Connexion en cours...</p>
                </div>

                <button type="submit" class="btn">Me connecter 🌙</button>
                
                <button type="button" class="link-button" onclick="showRegister()">
                    Pas encore de compte ? S'inscrire
                </button>
            </form>

            <div style="margin-top: 20px; text-align: center;">
                <button type="button" class="link-button" onclick="resetPassword()">
                    Mot de passe oublié ?
                </button>
            </div>
        </div>
    </div>

    <!-- PLANNER PRINCIPAL -->
    <div id="planner-screen" class="planner-container">
        <div class="container">
            <div class="header">
                <div class="user-info">
                    <span class="user-name" id="current-user">Salam ma sœur</span>
                    <button class="logout-btn" onclick="logout()">Déconnexion</button>
                </div>
                
                <div class="islamic-pattern">☪ ❋ ☪ ❋ ☪ ❋ ☪</div>
                <h1 class="main-title">El Bayt Essential</h1>
                <p class="subtitle">"Mon planner spirituel & quotidien"</p>
                <div class="islamic-pattern">☪ ❋ ☪ ❋ ☪ ❋ ☪</div>
            </div>

            <div class="amana-notice">
                <h3>🌿 Bienvenue dans ton espace personnel</h3>
                <p>Ma sœur, ce planner a été conçu avec amour pour t'accompagner dans ta routine spirituelle. Qu'ALLAH mette la baraka dans son utilisation. Amine.</p>
            </div>

            <div class="nav-tabs">
                <div class="nav-tab active" onclick="showPlannerTab('welcome')">Accueil</div>
                <div class="nav-tab" onclick="showPlannerTab('monthly-themes')">Thèmes Mensuels</div>
                <div class="nav-tab" onclick="showPlannerTab('monthly-planner')">Planificateur</div>
                <div class="nav-tab" onclick="showPlannerTab('spiritual-tracker')">Tracker Spirituel</div>
                <div class="nav-tab" onclick="showPlannerTab('victories')">Mes Victoires</div>
                <div class="nav-tab" onclick="showPlannerTab('year-review')">Bilan Annuel</div>
            </div>

            <!-- ACCUEIL DU PLANNER -->
            <div id="planner-welcome" class="tab-content active">
                <div class="welcome-section">
                    <div class="bismillah">
                        🌸 Bismillah – À toi ma sœur en Allah 🌸<br>
                        Assalamu 'alayki wa rahmatullahi wa barakatuh
                    </div>
                    
                    <p style="margin-bottom: 20px;">
                        Ce planner, c'est un petit outil pour nous aider à remettre notre Dine au centre de nos journées, avec douceur et bienveillance.
                    </p>
                    
                    <p style="margin-bottom: 30px;">
                        Chaque mois, tu découvriras un Nom d'ALLAH à méditer et essayer de vivre dans ton quotidien. Un pas après l'autre, avec sincérité.
                    </p>

                    <div class="instructions">
                        <h3>🌿 Comment utiliser ce planner :</h3>
                        <ul>
                            <li>Commence chaque mois par tes intentions</li>
                            <li>Remplis tes trackers spirituels chaque soir</li>
                            <li>Note tes gratitudes quotidiennes</li>
                            <li>Relis tes réflexions en fin de semaine</li>
                        </ul>
                    </div>

                    <p style="text-align: center; font-style: italic; color: #8d6e63; margin-top: 20px;">
                        Qu'ALLAH mette la baraka dans ton temps, te facilite, et te rapproche de Lui.<br>
                        Amine. 🤲
                    </p>
                </div>
            </div>

            <!-- THÈMES MENSUELS -->
            <div id="planner-monthly-themes" class="tab-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #b85450; margin-bottom: 20px;">Thèmes Spirituels Mensuels</h2>
                    <p style="color: #5d4037; font-style: italic;">Chaque mois, médite sur un des beaux Noms d'Allah</p>
                </div>

                <div class="month-theme-container">
                    <div style="font-size: 1.8em; color: #5d4037; margin-bottom: 10px;">LE MOIS DE</div>
                    <div style="font-size: 3em; color: #b85450; font-style: italic; margin: 20px 0;">SABR</div>
                    <div style="font-size: 2em; margin-bottom: 15px;">La patience</div>
                    <div style="font-style: italic; color: #5d4037;">(Sourate Al-Baqarah, 2:153)</div>
                </div>

                <div style="background: rgba(255, 192, 203, 0.2); padding: 20px; border-radius: 15px; text-align: left;">
                    <h3 style="color: #5d4037; margin-bottom: 15px;">Méditation sur As-Sabûr (Le Patient)</h3>
                    <p style="line-height: 1.6; color: #5d4037;">
                        Ma sœur, la patience n'est pas liée au fait d'être mariée ou d'avoir des enfants. Le sabr, c'est avant tout une qualité qu'on cultive dans sa relation avec ALLAH, dans son cœur, dans ses pensées, dans son quotidien — même quand personne n'est là pour le voir.
                    </p>
                    <p style="line-height: 1.6; color: #5d4037; margin-top: 15px;">
                        Le sabr, c'est cette capacité à persévérer dans l'adoration, même quand tu es seule et que personne ne te rappelle à la prière. C'est ce combat discret avec toi-même, quand l'âme te pousse à t'occuper de tout sauf d'ALLAH.
                    </p>
                </div>
            </div>

            <!-- Les autres sections du planner seront ajoutées ici -->
            <div id="planner-monthly-planner" class="tab-content">
                <div style="text-align: center; padding: 50px;">
                    <h2 style="color: #b85450;">Planificateur Mensuel</h2>
                    <p>Section en cours de développement...</p>
                </div>
            </div>

            <div id="planner-spiritual-tracker" class="tab-content">
                <div style="text-align: center; padding: 50px;">
                    <h2 style="color: #b85450;">Tracker Spirituel</h2>
                    <p>Section en cours de développement...</p>
                </div>
            </div>

            <div id="planner-victories" class="tab-content">
                <div style="text-align: center; padding: 50px;">
                    <h2 style="color: #b85450;">Mes Victoires</h2>
                    <p>Section en cours de développement...</p>
                </div>
            </div>

            <div id="planner-year-review" class="tab-content">
                <div style="text-align: center; padding: 50px;">
                    <h2 style="color: #b85450;">Bilan Annuel</h2>
                    <p>Section en cours de développement...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let users = JSON.parse(localStorage.getItem('elbayt_users') || '[]');
        let currentUser = JSON.parse(localStorage.getItem('elbayt_current_user') || 'null');

        // Debug initial
        console.log('Application initialisée');
        console.log('Utilisateurs existants:', users.length);
        console.log('Utilisateur actuel:', currentUser ? currentUser.name : 'Aucun');

        // Fonction d'inscription simplifiée
        function handleRegistration(e) {
            e.preventDefault();
            console.log('🚀 Inscription démarrée...');
            
            try {
                // Récupérer les valeurs du formulaire
                const name = document.getElementById('register-name').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                const dua = document.getElementById('register-dua').value.trim();
                const aspiration = document.getElementById('register-aspiration').value.trim();

                console.log('📝 Données récupérées:', { name, email, passwordLength: password.length });

                const messages = document.getElementById('register-messages');
                messages.innerHTML = '';

                // Validation simple
                if (!name) {
                    messages.innerHTML = '<div class="error-message">❌ Le prénom est obligatoire.</div>';
                    return;
                }

                if (!email || !email.includes('@')) {
                    messages.innerHTML = '<div class="error-message">❌ Veuillez entrer un email valide.</div>';
                    return;
                }

                if (password.length < 6) {
                    messages.innerHTML = '<div class="error-message">❌ Le mot de passe doit contenir au moins 6 caractères.</div>';
                    return;
                }

                if (password !== confirm) {
                    messages.innerHTML = '<div class="error-message">❌ Les mots de passe ne correspondent pas.</div>';
                    return;
                }

                // Vérifier si l'email existe déjà
                if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
                    messages.innerHTML = '<div class="error-message">❌ Cet email est déjà utilisé.</div>';
                    return;
                }

                console.log('✅ Validation réussie, création du compte...');

                // Afficher le chargement
                const loadingDiv = document.getElementById('register-loading');
                if (loadingDiv) {
                    loadingDiv.style.display = 'block';
                }

                // Créer le nouvel utilisateur
                const newUser = {
                    id: Date.now(),
                    name: name,
                    email: email.toLowerCase(),
                    password: password,
                    dua: dua,
                    aspiration: aspiration,
                    createdAt: new Date().toISOString(),
                    plannerData: {}
                };

                console.log('👤 Nouvel utilisateur créé:', { ...newUser, password: '***' });

                // Ajouter à la liste des utilisateurs
                users.push(newUser);
                localStorage.setItem('elbayt_users', JSON.stringify(users));
                
                // Connecter automatiquement
                currentUser = newUser;
                localStorage.setItem('elbayt_current_user', JSON.stringify(currentUser));
                
                console.log('💾 Utilisateur sauvegardé et connecté');
                
                // Cacher le chargement
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }
                
                // Afficher le message de succès
                messages.innerHTML = '<div class="success-message">🌟 Compte créé avec succès ! Bienvenue ma sœur ' + name + ' !</div>';
                
                // Rediriger vers le planner après 2 secondes
                setTimeout(() => {
                    console.log('🔄 Redirection vers le planner...');
                    showPlanner();
                }, 2000);
                
            } catch (error) {
                console.error('💥 Erreur lors de la création du compte:', error);
                const loadingDiv = document.getElementById('register-loading');
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }
                const messages = document.getElementById('register-messages');
                if (messages) {
                    messages.innerHTML = '<div class="error-message">❌ Erreur technique. Veuillez réessayer.</div>';
                }
            }
        }

        // Fonction pour attacher les événements avec multiple méthodes
        function attachEvents() {
            console.log('🔗 Attachement des événements...');
            
            // Méthode 1: Par le formulaire
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.onsubmit = handleRegistration;
                console.log('✅ Événement submit attaché au formulaire');
            } else {
                console.error('❌ Formulaire d\'inscription non trouvé');
            }
            
            // Méthode 2: Par le bouton directement
            const registerBtn = document.getElementById('register-btn');
            if (registerBtn) {
                registerBtn.onclick = function(e) {
                    console.log('🔘 Clic sur le bouton détecté');
                    handleRegistration(e);
                };
                console.log('✅ Événement click attaché au bouton');
            } else {
                console.error('❌ Bouton d\'inscription non trouvé');
            }

            // Connexion
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.onsubmit = function(e) {
                    e.preventDefault();
                    console.log('🔑 Tentative de connexion...');
                    
                    const email = document.getElementById('login-email').value.trim().toLowerCase();
                    const password = document.getElementById('login-password').value;
                    const messages = document.getElementById('login-messages');
                    
                    messages.innerHTML = '';
                    
                    if (!email || !password) {
                        messages.innerHTML = '<div class="error-message">❌ Veuillez remplir tous les champs.</div>';
                        return;
                    }
                    
                    const user = users.find(u => u.email === email && u.password === password);
                    
                    if (user) {
                        currentUser = user;
                        localStorage.setItem('elbayt_current_user', JSON.stringify(currentUser));
                        messages.innerHTML = '<div class="success-message">🌙 Connexion réussie !</div>';
                        setTimeout(() => showPlanner(), 1500);
                    } else {
                        messages.innerHTML = '<div class="error-message">❌ Email ou mot de passe incorrect.</div>';
                    }
                };
                console.log('✅ Événement de connexion attaché');
            }
        }

        // Au chargement du DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 DOM chargé');
            
            // Attacher les événements
            attachEvents();
            
            // Afficher l'écran approprié
            if (currentUser) {
                console.log('👤 Utilisateur déjà connecté');
                showPlanner();
            } else {
                console.log('🆕 Nouvel utilisateur, affichage inscription');
                showRegister();
            }
            
            // Test du bouton après un court délai
            setTimeout(() => {
                const btn = document.getElementById('register-btn');
                console.log('🔍 Test bouton après délai:', btn ? 'Trouvé' : 'Non trouvé');
                if (btn) {
                    console.log('🎯 Bouton présent dans le DOM');
                }
            }, 1000);
        });

        // Fonctions d'affichage des écrans
        function showRegister() {
            console.log('📱 Affichage écran inscription');
            document.getElementById('register-screen').style.display = 'flex';
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('planner-screen').style.display = 'none';
            
            // Ré-attacher les événements après affichage
            setTimeout(() => {
                attachEvents();
            }, 100);
        }

        function showLogin() {
            console.log('📱 Affichage écran connexion');
            document.getElementById('register-screen').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('planner-screen').style.display = 'none';
            
            // Ré-attacher les événements après affichage
            setTimeout(() => {
                attachEvents();
            }, 100);
        }

        function showPlanner() {
            console.log('📱 Affichage planner');
            document.getElementById('register-screen').style.display = 'none';
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('planner-screen').style.display = 'block';
            
            if (currentUser) {
                const userElement = document.getElementById('current-user');
                if (userElement) {
                    userElement.textContent = `Salam ${currentUser.name} 🌙`;
                }
            }
        }

        // Fonction d'inscription
        function handleRegistration(e) {
            e.preventDefault();
            console.log('Inscription démarrée...');
            
            // Récupérer les valeurs du formulaire
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            const dua = document.getElementById('register-dua').value.trim();
            const aspiration = document.getElementById('register-aspiration').value.trim();

            const messages = document.getElementById('register-messages');
            messages.innerHTML = '';

            console.log('Données récupérées:', { name, email, password: '***', confirm: '***' });

            // Validation
            if (!name) {
                messages.innerHTML = '<div class="error-message">Le prénom est obligatoire.</div>';
                return;
            }

            if (!email) {
                messages.innerHTML = '<div class="error-message">L\'email est obligatoire.</div>';
                return;
            }

            if (!email.includes('@') || !email.includes('.')) {
                messages.innerHTML = '<div class="error-message">Veuillez entrer un email valide.</div>';
                return;
            }

            if (!password) {
                messages.innerHTML = '<div class="error-message">Le mot de passe est obligatoire.</div>';
                return;
            }

            if (password.length < 6) {
                messages.innerHTML = '<div class="error-message">Le mot de passe doit contenir au moins 6 caractères.</div>';
                return;
            }

            if (password !== confirm) {
                messages.innerHTML = '<div class="error-message">Les mots de passe ne correspondent pas.</div>';
                return;
            }

            // Vérifier si l'email existe déjà
            const existingUser = users.find(u => u.email.toLowerCase() === email.toLowerCase());
            if (existingUser) {
                messages.innerHTML = '<div class="error-message">Cet email est déjà utilisé.</div>';
                return;
            }

            console.log('Validation réussie, création du compte...');

            // Afficher le chargement
            document.getElementById('register-loading').style.display = 'block';
            
            // Simulation du processus d'inscription
            setTimeout(() => {
                try {
                    // Créer le nouvel utilisateur
                    const newUser = {
                        id: Date.now(),
                        name: name,
                        email: email.toLowerCase(),
                        password: password, // En production, il faudrait hasher le mot de passe
                        dua: dua,
                        aspiration: aspiration,
                        createdAt: new Date().toISOString(),
                        plannerData: {}
                    };

                    console.log('Nouvel utilisateur créé:', { ...newUser, password: '***' });

                    // Ajouter à la liste des utilisateurs
                    users.push(newUser);
                    localStorage.setItem('elbayt_users', JSON.stringify(users));
                    
                    // Connecter automatiquement
                    currentUser = newUser;
                    localStorage.setItem('elbayt_current_user', JSON.stringify(currentUser));
                    
                    console.log('Utilisateur sauvegardé et connecté');
                    
                    // Cacher le chargement
                    document.getElementById('register-loading').style.display = 'none';
                    
                    // Afficher le message de succès
                    messages.innerHTML = '<div class="success-message">🌟 Compte créé avec succès ! Bienvenue ma sœur ' + name + ' !</div>';
                    
                    // Rediriger vers le planner après 2 secondes
                    setTimeout(() => {
                        console.log('Redirection vers le planner...');
                        showPlanner();
                    }, 2000);
                    
                } catch (error) {
                    console.error('Erreur lors de la création du compte:', error);
                    document.getElementById('register-loading').style.display = 'none';
                    messages.innerHTML = '<div class="error-message">Erreur lors de la création du compte. Veuillez réessayer.</div>';
                }
            }, 1500);
        }

        // Fonction de connexion
        function handleLogin(e) {
            e.preventDefault();
            console.log('Connexion démarrée...');
            
            const email = document.getElementById('login-email').value.trim().toLowerCase();
            const password = document.getElementById('login-password').value;

            const messages = document.getElementById('login-messages');
            messages.innerHTML = '';

            console.log('Tentative de connexion pour:', email);

            // Validation basique
            if (!email || !password) {
                messages.innerHTML = '<div class="error-message">Veuillez remplir tous les champs.</div>';
                return;
            }

            // Afficher le chargement
            document.getElementById('login-loading').style.display = 'block';
            
            setTimeout(() => {
                try {
                    // Vérifier les identifiants
                    const user = users.find(u => u.email.toLowerCase() === email && u.password === password);
                    
                    document.getElementById('login-loading').style.display = 'none';
                    
                    if (user) {
                        console.log('Connexion réussie pour:', user.name);
                        currentUser = user;
                        localStorage.setItem('elbayt_current_user', JSON.stringify(currentUser));
                        
                        messages.innerHTML = '<div class="success-message">🌙 Connexion réussie ! Salam ' + user.name + ' !</div>';
                        
                        setTimeout(() => {
                            showPlanner();
                            startMotivationalMessages(); // Démarrer les messages motivationnels
                        }, 1500);
                    } else {
                        console.log('Échec de la connexion - identifiants incorrects');
                        console.log('Utilisateurs disponibles:', users.map(u => ({ email: u.email, name: u.name })));
                        messages.innerHTML = '<div class="error-message">Email ou mot de passe incorrect.</div>';
                    }
                } catch (error) {
                    console.error('Erreur lors de la connexion:', error);
                    document.getElementById('login-loading').style.display = 'none';
                    messages.innerHTML = '<div class="error-message">Erreur lors de la connexion. Veuillez réessayer.</div>';
                }
            }, 1000);
        }

        // Attacher tous les événements au chargement du DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM chargé, attachement des événements...');
            
            // Événement d'inscription
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.addEventListener('submit', handleRegistration);
                console.log('Événement d\'inscription attaché');
            }

            // Événement de connexion
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('Événement de connexion attaché');
            }

            // Vérifier si l'utilisateur est déjà connecté
            console.log('Utilisateur actuel:', currentUser);
            if (currentUser) {
                console.log('Utilisateur déjà connecté, affichage du planner...');
                showPlanner();
                setTimeout(() => {
                    startMotivationalMessages();
                }, 30000);
            } else {
                console.log('Aucun utilisateur connecté, affichage de l\'inscription');
                showRegister();
            }

            // Debug: Afficher les utilisateurs existants
            console.log('Utilisateurs enregistrés:', users.length);
            users.forEach((user, index) => {
                console.log(`Utilisateur ${index + 1}:`, { name: user.name, email: user.email });
            });
        });

        // Connexion
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const email = formData.get('email');
            const password = formData.get('password');

            const messages = document.getElementById('login-messages');
            messages.innerHTML = '';

            // Simulation du chargement
            document.getElementById('login-loading').style.display = 'block';
            
            setTimeout(() => {
                // Vérifier les identifiants
                const user = users.find(u => u.email === email && u.password === password);
                
                document.getElementById('login-loading').style.display = 'none';
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('elbayt_current_user', JSON.stringify(currentUser));
                    
                    messages.innerHTML = '<div class="success-message">🌙 Connexion réussie ! Salam ma sœur !</div>';
                    
                    setTimeout(() => {
                        showPlanner();
                    }, 1500);
                } else {
                    messages.innerHTML = '<div class="error-message">Email ou mot de passe incorrect.</div>';
                }
            }, 1500);
        });

        // Déconnexion
        function logout() {
            if (confirm('Es-tu sûre de vouloir te déconnecter ?')) {
                currentUser = null;
                localStorage.removeItem('elbayt_current_user');
                showLogin();
            }
        }

        // Réinitialisation du mot de passe
        function resetPassword() {
            const email = prompt('Entre ton email pour réinitialiser ton mot de passe :');
            if (email) {
                const user = users.find(u => u.email === email);
                if (user) {
                    alert('🌿 Un email de réinitialisation a été envoyé ! (Fonctionnalité simulée)');
                } else {
                    alert('❌ Aucun compte trouvé avec cet email.');
                }
            }
        }

        // Navigation dans le planner
        function showPlannerTab(tabName) {
            // Cacher tous les contenus
            const contents = document.querySelectorAll('#planner-screen .tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Désactiver tous les onglets
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Afficher le contenu sélectionné
            document.getElementById(`planner-${tabName}`).classList.add('active');
            
            // Activer l'onglet sélectionné
            event.target.classList.add('active');
        }

        // Fonctions de sauvegarde des données du planner
        function savePlannerData() {
            if (currentUser) {
                // Sauvegarder les données spécifiques au planner
                const plannerData = {
                    lastAccess: new Date().toISOString(),
                    // Ici on ajouterait les données du planner
                };
                
                // Mettre à jour les données utilisateur
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].plannerData = plannerData;
                    localStorage.setItem('elbayt_users', JSON.stringify(users));
                }
            }
        }

        // Sauvegarder automatiquement les données
        setInterval(savePlannerData, 30000); // Sauvegarde toutes les 30 secondes

        // Messages de bienvenue personnalisés selon l'heure
        function getGreetingMessage() {
            const hour = new Date().getHours();
            if (hour < 12) {
                return "Bonjour et barakallahu fiki pour ce nouveau jour 🌅";
            } else if (hour < 17) {
                return "Bon après-midi ma sœur, qu'Allah bénisse ton temps 🌞";
            } else {
                return "Bonsoir, qu'Allah clôture ta journée en beauté 🌙";
            }
        }

        // Validation en temps réel des formulaires
        document.getElementById('register-password').addEventListener('input', function() {
            const password = this.value;
            const strength = document.getElementById('password-strength') || (() => {
                const div = document.createElement('div');
                div.id = 'password-strength';
                div.style.fontSize = '12px';
                div.style.marginTop = '5px';
                this.parentNode.appendChild(div);
                return div;
            })();
            
            if (password.length === 0) {
                strength.innerHTML = '';
            } else if (password.length < 6) {
                strength.innerHTML = '<span style="color: #e74c3c;">⚠️ Trop court (min. 6 caractères)</span>';
            } else if (password.length < 8) {
                strength.innerHTML = '<span style="color: #f39c12;">⚡ Moyen</span>';
            } else {
                strength.innerHTML = '<span style="color: #27ae60;">✅ Fort</span>';
            }
        });

        document.getElementById('register-confirm').addEventListener('input', function() {
            const password = document.getElementById('register-password').value;
            const confirm = this.value;
            const match = document.getElementById('password-match') || (() => {
                const div = document.createElement('div');
                div.id = 'password-match';
                div.style.fontSize = '12px';
                div.style.marginTop = '5px';
                this.parentNode.appendChild(div);
                return div;
            })();
            
            if (confirm.length === 0) {
                match.innerHTML = '';
            } else if (password === confirm) {
                match.innerHTML = '<span style="color: #27ae60;">✅ Mots de passe identiques</span>';
            } else {
                match.innerHTML = '<span style="color: #e74c3c;">❌ Mots de passe différents</span>';
            }
        });

        // Fonctionnalités pour démonstration - Thèmes mensuels
        const themes = {
            sabr: {
                title: 'SABR',
                subtitle: 'La patience',
                verse: '(Sourate Al-Baqarah, 2:153)',
                emoji: '🦋',
                reflection: 'Ma sœur, la patience n\'est pas liée au fait d\'être mariée ou d\'avoir des enfants. Le sabr, c\'est avant tout une qualité qu\'on cultive dans sa relation avec ALLAH, dans son cœur, dans ses pensées, dans son quotidien.',
                actions: [
                    'Respirer et se taire face à la colère',
                    'Ne pas trop se plaindre de l\'épreuve',
                    'Persévérer dans les petites habitudes',
                    'Garder le silence face aux critiques'
                ]
            },
            choukr: {
                title: 'CHOUKR',
                subtitle: 'La gratitude',
                verse: '(Sourate Ibrahim, 14:7)',
                emoji: '🌺',
                reflection: 'Ma sœur, la gratitude n\'est pas liée aux biens que l\'on possède. Le choukr, c\'est cette qualité qu\'on cultive dans sa relation avec ALLAH, dans son cœur — même dans les moments difficiles.',
                actions: [
                    'Noter 3 gratitudes chaque soir',
                    'Remercier une personne différente chaque jour',
                    'Transformer mes plaintes en remerciements',
                    'Trouver du positif dans chaque épreuve'
                ]
            },
            tawakkul: {
                title: 'TAWAKKUL',
                subtitle: 'La confiance en ALLAH',
                verse: '(Sourate Al-Imran, 3:159)',
                emoji: '🕊️',
                reflection: 'Ma sœur, la confiance en ALLAH n\'est pas liée à l\'absence d\'épreuves, mais à cette certitude profonde que ton Créateur ne t\'abandonne jamais.',
                actions: [
                    'Faire ses efforts puis lâcher prise',
                    'Accepter les imprévus comme des signes',
                    'Ne pas s\'angoisser pour l\'issue',
                    'Transformer inquiétudes en duas'
                ]
            }
        };

        // Fonction pour changer de thème (démonstration)
        function changeTheme(themeName) {
            const theme = themes[themeName] || themes.sabr;
            const container = document.getElementById('planner-monthly-themes');
            
            const themeSection = container.querySelector('.month-theme-container');
            if (themeSection) {
                themeSection.innerHTML = `
                    <div style="font-size: 1.8em; color: #5d4037; margin-bottom: 10px;">LE MOIS DE</div>
                    <div style="font-size: 3em; color: #b85450; font-style: italic; margin: 20px 0;">${theme.title}</div>
                    <div style="font-size: 2em; margin-bottom: 15px;">${theme.subtitle}</div>
                    <div style="font-style: italic; color: #5d4037;">${theme.verse}</div>
                    <div style="position: absolute; top: 10px; right: 20px; font-size: 3em; opacity: 0.3;">${theme.emoji}</div>
                `;
            }
            
            const reflectionSection = container.querySelector('div[style*="rgba(255, 192, 203, 0.2)"]');
            if (reflectionSection) {
                reflectionSection.innerHTML = `
                    <h3 style="color: #5d4037; margin-bottom: 15px;">Méditation sur ${theme.title}</h3>
                    <p style="line-height: 1.6; color: #5d4037;">${theme.reflection}</p>
                    <div style="margin-top: 20px;">
                        <h4 style="color: #8e24aa; margin-bottom: 10px;">Actions Concrètes :</h4>
                        <ul style="color: #5d4037;">
                            ${theme.actions.map(action => `<li style="margin-bottom: 8px;">✓ ${action}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        }

        // Ajouter des boutons pour changer de thème (démonstration)
        document.addEventListener('DOMContentLoaded', function() {
            const themesContainer = document.getElementById('planner-monthly-themes');
            if (themesContainer) {
                const buttonContainer = document.createElement('div');
                buttonContainer.style.textAlign = 'center';
                buttonContainer.style.marginBottom = '20px';
                buttonContainer.innerHTML = `
                    <button onclick="changeTheme('sabr')" class="btn" style="margin: 5px; padding: 8px 15px; font-size: 12px;">SABR</button>
                    <button onclick="changeTheme('choukr')" class="btn" style="margin: 5px; padding: 8px 15px; font-size: 12px;">CHOUKR</button>
                    <button onclick="changeTheme('tawakkul')" class="btn" style="margin: 5px; padding: 8px 15px; font-size: 12px;">TAWAKKUL</button>
                `;
                themesContainer.insertBefore(buttonContainer, themesContainer.firstChild);
            }
        });

        // Fonctionnalités de développement progressif
        function showComingSoon(sectionName) {
            alert(`🌟 La section "${sectionName}" sera bientôt disponible incha'Allah !\n\nPour l'instant, profite des sections Accueil et Thèmes Mensuels.`);
        }

        // Mise à jour des sections non développées
        document.addEventListener('DOMContentLoaded', function() {
            const sections = ['monthly-planner', 'spiritual-tracker', 'victories', 'year-review'];
            sections.forEach(section => {
                const element = document.getElementById(`planner-${section}`);
                if (element) {
                    element.innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <h2 style="color: #b85450; margin-bottom: 20px;">🚧 Section en développement</h2>
                            <div style="font-size: 4em; opacity: 0.3; margin: 20px 0;">🌱</div>
                            <p style="color: #5d4037; margin-bottom: 20px;">Cette section sera bientôt disponible incha'Allah.</p>
                            <p style="color: #8d6e63; font-style: italic;">En attendant, explore les Thèmes Mensuels pour commencer ton cheminement spirituel.</p>
                            <button onclick="showPlannerTab('monthly-themes')" class="btn" style="margin-top: 20px;">
                                Découvrir les Thèmes 🌸
                            </button>
                        </div>
                    `;
                }
            });
        });

        // Messages motivationnels aléatoires
        const motivationalMessages = [
            "🌟 Qu'Allah bénisse ton cheminement spirituel ma sœur",
            "🌙 Chaque petit pas compte dans ta relation avec Allah",
            "🌸 Ta sincérité dans l'adoration illumine ton cœur",
            "🦋 Allah voit tes efforts même les plus discrets",
            "🌺 Barakallahu fiki pour ton engagement spirituel"
        ];

        function showMotivationalMessage() {
            const message = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = `
                <div style="
                    position: fixed; 
                    top: 20px; 
                    right: 20px; 
                    background: rgba(212, 175, 55, 0.9); 
                    color: white; 
                    padding: 15px 20px; 
                    border-radius: 10px; 
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 1000;
                    animation: slideIn 0.5s ease;
                    max-width: 300px;
                    font-size: 14px;
                ">
                    ${message}
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        float: right; 
                        background: none; 
                        border: none; 
                        color: white; 
                        font-size: 16px; 
                        cursor: pointer;
                        margin-left: 10px;
                    ">×</button>
                </div>
            `;
            document.body.appendChild(messageDiv);
            
            // Supprimer automatiquement après 5 secondes
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // Afficher un message motivationnel toutes les 2 minutes quand l'utilisateur est connecté
        let motivationalInterval;
        function startMotivationalMessages() {
            if (motivationalInterval) clearInterval(motivationalInterval);
            motivationalInterval = setInterval(showMotivationalMessage, 120000); // 2 minutes
        }

        function stopMotivationalMessages() {
            if (motivationalInterval) clearInterval(motivationalInterval);
        }

        // Animation pour les messages
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // Démarrer les messages motivationnels si un utilisateur est connecté
        if (currentUser) {
            setTimeout(() => {
                startMotivationalMessages();
            }, 30000); // Premier message après 30 secondes
        }

    </script>
</body>
</html>